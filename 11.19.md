### 浏览器缓存
- 前端 
- 缓存

强制缓存阶段
``` flow
start=>start: 请求开始
end2=>operation: 读取浏览器缓存
end3=>operation: 服务器返回资源200
end4=>operation: 服务器返回304

askService=>operation: 请求服务器

op1=>condition: first 或者 Cache-control: no-store
op2=>condition: Cache-Control:no-cache 或者 Pragma: no-cache
op3=>condition: Cache-Control:max-age 或者 Expires 有效
op4=>condition: If-None-Match: Etag1
op5=>condition: 存在Etag1的资源?
op6=>condition: If-Modified-Since: t1 && Last-Modified: t2 && t1 < t2


start->op1
op1(no)->askService
op1(yes,right)->op2
op2(no)->op3
op2(yes)->askService
op3(yes,right)->end2
op3(no)->askService
askService->op4
op4(no)->end3
op4(yes,right)->op5
op5(yes,right)->op6
op5(no)->end3
op6(yes,right)->end4
op6(no)->end3
end4->end2



```
##### 1. `Cache-control` HTTP 1.1
不区分大小写 单向 多个值以逗号分隔

```
header.Cache-Control
```
| 值  | 单位  | 含义 | 类型|
|---|---|---|---|
|`max-stale=10`| s | 可接受的过期时间 | `req`|
|`min-fresh=10`| s | 指定的时间内获取最新的响应 | `req`|
|`max-age=10`  | s | 指定时间后过期 | `req` `res`|
|`no-cache`    |   | 交给服务器判断  | `req` `res` |
|`no-store`    |   | 请求响应都不缓存| `req` `res`|
|`no-transform`|   | 禁止代理服转换,如gzip| `req` `res`| 
|`only-if-cached`| | 只接受缓存数据| `req`|
|`must-revalidate`| | 失效情况强制请求服务器,与`max-stale`对应 | `res` |
|`public`| | 允许客户端,代理服等缓存 | `res` |
|`private`| | 只允许客户端缓存 |`res` |
|`proxy-revalidate`| | 失效情况强制请求服务器,与`max-stale`对应 | `res` |
|`s-maxage=10`| | 在代理服上忽略`max-age`| `res`|

##### 2. `Expires` HTTP 1.0
|  值 |  含义 | 类型|
|---|---|---|
|  Wed, 21 Oct 2015 07:28:00 GMT |  缓存有效截止时间 | `req`|

`Cache-control: max-age=10` > `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
`Cache-control: public,s-maxage=10` > `Expires: Wed, 21 Oct 2015 07:28:00 GMT`

##### 3. `Pragma` HTTP 1.0
MDN不建议使用
|  值 |  含义  | 类型 |
|---|---|---|
|  `no-cache` | 不使用本地缓存,交给服务器判断  | `res` |

##### 4. `Last-Modified` HTTP 1.0
|  值 |  含义 | 类型 |
|---|---|---|
|  `Wed, 21 Oct 2015 07:28:00 GMT` | 资源最后修改时间  | `res`|

##### 5. `If-Modified-Since` HTTP 1.0
只可以用在 `GET` 或 `HEAD` 请求中
|  值 | 含义  | 类型|
|---|---|---|
| `Wed, 21 Oct 2015 07:28:00 GMT` ,一般为上次返回的`Last-Modified` |  在这个时间之后修改才返回200,否则返回304 | `req` |

##### 6. `Etag` HTTP 1.1
|  值 | 含义  |
|---|---|
| `[W/]?675af34563dc-tr34`  | 类似hash值,没有明确指定生成ETag值的方法  |
##### 7. `If-None-Match`
依赖`Etag`
| 值  | 含义  |
|---|---|
| 675af34563dc-tr34,675af34563dc-tr35  |  服务器不存在对应资源,才重新获取资源 |








#### 参考链接
1. https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control
2. https://juejin.im/post/58eacff90ce4630058668257





### markdown流程图
- start # 开始
- end # 结束
- operation # 操作
- subroutine # 子程序
- condition # 条件
- inputoutput # 输入或产出